<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ship â€” Job Notification Tracker</title>
  <link rel="stylesheet" href="../design-system.css">
  <link rel="stylesheet" href="../app.css">
</head>
<body class="app">
  <header class="app-nav" id="app-nav" role="navigation">
    <a href="../index.html" class="app-nav__brand">Job Notification Tracker</a>
    <ul class="app-nav__links">
      <li><a href="../dashboard.html">Dashboard</a></li>
      <li><a href="../saved.html">Saved</a></li>
      <li><a href="../digest.html">Digest</a></li>
      <li><a href="../settings.html">Settings</a></li>
      <li><a href="../proof.html">Proof</a></li>
    </ul>
    <button type="button" class="app-nav__toggle" id="nav-toggle" aria-label="Toggle menu">
      <span class="app-nav__toggle-icon"></span>
    </button>
  </header>
  <main class="app-main">
    <h1 class="app-page-heading">Ship</h1>

    <div class="ship-status" id="ship-status">
      <span class="ship-status__badge ship-status__badge--not-started" id="ship-status-badge">Not Started</span>
    </div>

    <div class="ship-locked" id="ship-locked">
      <h2 class="ship-locked__title">Ship Locked</h2>
      <p class="ship-locked__text">Complete all tests in the checklist to unlock shipping.</p>
      <a href="07-test.html" class="kn-btn kn-btn--primary">Go to Test Checklist</a>
    </div>

    <div class="ship-unlocked" id="ship-unlocked" hidden>
      <h2 class="ship-unlocked__title">Ready to Ship</h2>
      <p class="ship-unlocked__text">All tests passed. Add proof links and submit from <a href="proof.html">Proof &amp; submission</a> to mark as Shipped.</p>
    </div>

    <p class="ship-success-msg" id="ship-success-msg" hidden>Project 1 Shipped Successfully.</p>
  </main>

  <script>
    (function () {
      var STORAGE_KEY = 'jobTrackerTestChecklist';
      var ARTIFACTS_KEY = 'jobTrackerProofArtifacts';
      var TOTAL_TESTS = 10;

      function getChecklist() {
        try {
          var raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : {};
        } catch (e) {
          return {};
        }
      }

      function getArtifacts() {
        try {
          var raw = localStorage.getItem(ARTIFACTS_KEY);
          return raw ? JSON.parse(raw) : { lovable: '', github: '', deployed: '' };
        } catch (e) {
          return { lovable: '', github: '', deployed: '' };
        }
      }

      function isValidUrl(s) {
        if (!s || typeof s !== 'string') return false;
        s = s.trim();
        if (!s) return false;
        try {
          var u = new URL(s);
          return u.protocol === 'https:' || u.protocol === 'http:';
        } catch (e) {
          return false;
        }
      }

      function allThreeLinksProvided() {
        var a = getArtifacts();
        return isValidUrl(a.lovable) && isValidUrl(a.github) && isValidUrl(a.deployed);
      }

      function updateStatusBadge() {
        var checklist = getChecklist();
        var passed = Object.keys(checklist).filter(function (k) { return checklist[k] === true; }).length;
        var allTests = passed === TOTAL_TESTS;
        var allLinks = allThreeLinksProvided();

        var badge = document.getElementById('ship-status-badge');
        var successMsg = document.getElementById('ship-success-msg');
        if (!badge) return;

        if (allTests && allLinks) {
          badge.textContent = 'Shipped';
          badge.className = 'ship-status__badge ship-status__badge--shipped';
          if (successMsg) successMsg.hidden = false;
        } else {
          if (successMsg) successMsg.hidden = true;
          var anyProgress = passed > 0 || allLinks;
          badge.textContent = anyProgress ? 'In Progress' : 'Not Started';
          badge.className = 'ship-status__badge ship-status__badge--' + (anyProgress ? 'in-progress' : 'not-started');
        }
      }

      function checkUnlocked() {
        var checklist = getChecklist();
        var passed = Object.keys(checklist).filter(function (k) { return checklist[k] === true; }).length;
        var locked = document.getElementById('ship-locked');
        var unlocked = document.getElementById('ship-unlocked');
        if (passed === TOTAL_TESTS) {
          locked.hidden = true;
          unlocked.hidden = false;
        } else {
          locked.hidden = false;
          unlocked.hidden = true;
        }
        updateStatusBadge();
      }

      document.getElementById('nav-toggle').addEventListener('click', function () {
        document.getElementById('app-nav').classList.toggle('is-open');
      });

      checkUnlocked();
    })();
  </script>
</body>
</html>
